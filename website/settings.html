<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings ‚Äî Tiriwe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="js/tiriwe-core.js"></script>
    <style>
        :root {
            --green: #2E7D32; --green-light: #43A047; --green-dark: #1B5E20; --green-pale: #E8F5E9;
            --orange: #FF9800; --orange-pale: #FFF3E0;
            --red: #F44336; --blue: #1565C0; --blue-pale: #E3F2FD;
            --purple: #7B1FA2; --purple-pale: #F3E5F5;
            --white: #ffffff; --off-white: #f8fafc;
            --text: #1e293b; --text-mid: #475569; --text-muted: #94a3b8;
            --border: #e2e8f0; --radius: 12px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08); --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; color: var(--text); background: var(--off-white); line-height: 1.6; }

        .settings-container { max-width: 720px; margin: 0 auto; padding: 32px 24px 80px; }

        /* Welcome banner */
        .welcome-banner {
            background: linear-gradient(135deg, var(--green-dark), var(--green));
            color: white; border-radius: var(--radius); padding: 28px 32px;
            margin-bottom: 32px; display: none;
        }
        .welcome-banner.visible { display: block; }
        .welcome-banner h1 { font-size: 24px; font-weight: 800; margin-bottom: 8px; }
        .welcome-banner p { font-size: 15px; opacity: 0.9; line-height: 1.6; }

        /* Page header */
        .page-header { margin-bottom: 32px; }
        .page-header h1 { font-size: 28px; font-weight: 800; }
        .page-header p { color: var(--text-mid); font-size: 15px; margin-top: 4px; }

        /* User summary */
        .user-summary {
            background: white; border-radius: var(--radius); border: 1px solid var(--border);
            padding: 24px; margin-bottom: 24px; display: flex; align-items: center; gap: 16px;
        }
        .user-avatar {
            width: 64px; height: 64px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 32px; flex-shrink: 0;
        }
        .user-details { flex: 1; }
        .user-name { font-size: 18px; font-weight: 700; }
        .user-meta { font-size: 13px; color: var(--text-muted); margin-top: 2px; }
        .user-verification {
            display: inline-flex; align-items: center; gap: 4px;
            font-size: 12px; font-weight: 600; padding: 3px 10px; border-radius: 20px; margin-top: 6px;
        }

        /* Nav cards */
        .nav-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .nav-card {
            background: white; border-radius: var(--radius); border: 1px solid var(--border);
            padding: 24px; text-decoration: none; color: inherit;
            transition: all 0.2s; cursor: pointer; display: flex; flex-direction: column; gap: 12px;
        }
        .nav-card:hover { border-color: var(--green); box-shadow: var(--shadow-md); transform: translateY(-2px); }
        .nav-card.highlight { border-color: var(--orange); box-shadow: 0 0 0 3px rgba(255,152,0,0.1); }
        .nav-card-icon {
            width: 48px; height: 48px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 24px;
        }
        .nav-card-icon.green { background: var(--green-pale); }
        .nav-card-icon.red { background: #FFEBEE; }
        .nav-card-icon.blue { background: var(--blue-pale); }
        .nav-card-icon.purple { background: var(--purple-pale); }
        .nav-card h3 { font-size: 16px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .nav-card p { font-size: 13px; color: var(--text-muted); line-height: 1.5; }
        .card-badge {
            font-size: 10px; font-weight: 700; text-transform: uppercase; padding: 2px 8px; border-radius: 4px;
        }
        .badge-required { background: var(--orange-pale); color: #E65100; }
        .badge-new { background: var(--blue-pale); color: var(--blue); }
        .badge-free { background: var(--green-pale); color: var(--green); }
        .nav-card-arrow { font-size: 14px; color: var(--text-muted); margin-top: auto; display: flex; align-items: center; gap: 4px; font-weight: 500; }
        .nav-card:hover .nav-card-arrow { color: var(--green); }

        /* Loading */
        .loading-screen { display: flex; align-items: center; justify-content: center; min-height: 60vh; flex-direction: column; gap: 16px; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid var(--border); border-top-color: var(--green); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { color: var(--text-muted); font-size: 14px; }

        @media (max-width: 600px) {
            .nav-cards { grid-template-columns: 1fr; }
            .settings-container { padding: 16px 16px 80px; }
            .user-summary { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>

<nav id="tiriwe-nav"></nav>

<!-- Loading -->
<div class="settings-container" id="loading-screen">
    <div class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading your settings...</div>
    </div>
</div>

<!-- Main content -->
<div class="settings-container" id="settings-content" style="display:none;">

    <div class="welcome-banner" id="welcome-banner">
        <h1>Welcome to Tiriwe!</h1>
        <p>Let's get you set up. Start with <strong>My Profile</strong> ‚Äî fill in the basics so the community can connect with you. You can always come back to add more later.</p>
    </div>

    <div class="page-header" id="page-header">
        <h1>Settings</h1>
        <p>Manage your profile, safety information, transport & subscription.</p>
    </div>

    <div class="user-summary" id="user-summary">
        <div class="user-avatar" id="user-avatar">üë§</div>
        <div class="user-details">
            <div class="user-name" id="user-name">Loading...</div>
            <div class="user-meta" id="user-email"></div>
            <div class="user-verification" id="user-verification"></div>
        </div>
    </div>

    <div class="nav-cards">

        <a href="profile.html" class="nav-card" id="card-profile">
            <div class="nav-card-icon green">üë§</div>
            <h3>My Profile <span class="card-badge badge-required" id="badge-profile" style="display:none">Set up</span></h3>
            <p>Name, gender, photos, home location, availability, privacy & notifications.</p>
            <div class="nav-card-arrow">Open ‚Üí</div>
        </a>

        <a href="emergency.html" class="nav-card" id="card-emergency">
            <div class="nav-card-icon red">‚ù§Ô∏è</div>
            <h3>In Case of Emergency</h3>
            <p>Medical info, medications, passports, visas, insurance & emergency contacts.</p>
            <div class="nav-card-arrow">Open ‚Üí</div>
        </a>

        <a href="transport.html" class="nav-card" id="card-transport">
            <div class="nav-card-icon blue">üöó</div>
            <h3>Transport Register</h3>
            <p>Vehicles, motorcycles, bicycles & boats. Helps identify you on the road.</p>
            <div class="nav-card-arrow">Open ‚Üí</div>
        </a>

        <a href="subscription.html" class="nav-card" id="card-subscription">
            <div class="nav-card-icon purple">‚≠ê</div>
            <h3>Subscription <span class="card-badge badge-free">Free</span></h3>
            <p>View your current plan and explore premium features.</p>
            <div class="nav-card-arrow">Open ‚Üí</div>
        </a>

    </div>
</div>

<script>
    Tiriwe.ready().then(() => {
        const user = Tiriwe.user;
        if (!user) return;

        const isFirstTime = !Tiriwe.isProfileComplete(user);

        // User summary
        document.getElementById('user-avatar').textContent = user.avatar_emoji || 'üë§';
        document.getElementById('user-avatar').style.background = user.avatar_color || '#E8F5E9';
        document.getElementById('user-name').textContent = user.display_name || 'New User';
        document.getElementById('user-email').textContent = user.email || '';

        const vInfo = Tiriwe.getVerificationInfo(user.verification_level);
        const vEl = document.getElementById('user-verification');
        vEl.textContent = vInfo.icon + ' ' + vInfo.name;
        vEl.style.background = vInfo.color + '15';
        vEl.style.color = vInfo.color;

        // First-time highlights
        if (isFirstTime) {
            document.getElementById('welcome-banner').classList.add('visible');
            document.getElementById('page-header').style.display = 'none';
            document.getElementById('card-profile').classList.add('highlight');
            document.getElementById('badge-profile').style.display = 'inline';
        }

        // Show content
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('settings-content').style.display = 'block';
    });
</script>

</body>
</html>
